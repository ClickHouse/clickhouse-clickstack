(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8374],{57478:(e,t,s)=>{"use strict";s.d(t,{J:()=>h,W:()=>v});var r=s(6029),a=s(75155),n=s(55729),i=s(8737),l=s(48259),o=s(17283),c=s(9211),u=s(98142),d=s(81973),m=s(89011),p=s.n(m);let h=({sourceSchemaPreview:e})=>e?{rightSection:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.N,{onClick:e=>{e.stopPropagation(),e.preventDefault()},className:p().sourceSchemaPreviewButton,children:e}),(0,r.jsx)(l.l,{})]}),rightSectionWidth:70}:{rightSection:(0,r.jsx)(l.l,{})};function g(e,t){return e.label.localeCompare(t.label)}function x(e){return{value:e.id,label:e.name}}let v=(0,n.memo)(function(e){let t,s,n,i,l,m,p,v,f,S,y,j=(0,a.c)(25);j[0]!==e?({size:l,onCreate:n,allowedSourceKinds:t,comboboxProps:s,sourceSchemaPreview:m,...i}=e,j[0]=e,j[1]=t,j[2]=s,j[3]=n,j[4]=i,j[5]=l,j[6]=m):(t=j[1],s=j[2],n=j[3],i=j[4],l=j[5],m=j[6]);let{data:b}=(0,d.oE)(),C=!!u.m6;if(j[7]!==t||j[8]!==b||j[9]!==n){let e;j[11]!==n?(e=n&&!C?[{value:"_create_new_value",label:"Create New Source"}]:[],j[11]=n,j[12]=e):e=j[12],p=[...(b?.filter(e=>!t||t.includes(e.kind)).map(x)??[]).sort(g),...e],j[7]=t,j[8]=b,j[9]=n,j[10]=p}else p=j[10];let N=p;j[13]!==m?(v=h({sourceSchemaPreview:m}),j[13]=m,j[14]=v):v=j[14];let _=v;return j[15]!==s?(f={withinPortal:!1,...s},j[15]=s,j[16]=f):f=j[16],j[17]===Symbol.for("react.memo_cache_sentinel")?(S=(0,r.jsx)(o.A,{size:16}),j[17]=S):S=j[17],j[18]!==n||j[19]!==i||j[20]!==_||j[21]!==l||j[22]!==f||j[23]!==N?(y=(0,r.jsx)(c.A,{...i,data:N,comboboxProps:f,searchable:!0,placeholder:"Data Source",leftSection:S,maxDropdownHeight:280,size:l,onCreate:n,..._}),j[18]=n,j[19]=i,j[20]=_,j[21]=l,j[22]=f,j[23]=N,j[24]=y):y=j[24],y})},58153:(e,t,s)=>{"use strict";s.d(t,{A:()=>$});var r,a=s(6029),n=s(75155),i=s(55729),l=s(91715),o=s(43465),c=s(86508),u=s(67549),d=s(83595),m=s(66692),p=s(43517),h=s(37659),g=s(59029),x=s(3635),v=s(63085),f=s(87989),S=s(25062),y=s(20158),j=s(62801),b=s(53993),C=s(34834),N=s(92789),_=s(90124),q=s(38206),E=s(59705),R=s(58061),w=s(78341),D=s(27798),k=s(14105),P=s(57820),A=((r={}).Range="Time range",r.Around="Around a time",r),I=s(75071),M=s(13759);let T=(0,d.tG)("hdx-time-picker-mode",A.Range),B=e=>{let t,s=(0,n.c)(2);return s[0]!==e?(t=(0,a.jsx)(R.J,{size:"xs",highlightToday:!0,placeholder:"YYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss",variant:"filled",dateParser:M.ad,onKeyDown:L,...e}),s[0]=e,s[1]=t):t=s[1],t},z=e=>{let t,s=(0,n.c)(2),{children:r}=e;return s[0]!==r?(t=(0,a.jsx)(p.E,{size:"xxs",c:"dimmed",lh:1.1,children:r}),s[0]=r,s[1]=t):t=s[1],t},$=(0,i.memo)(({inputValue:e,setInputValue:t,onSearch:s,onRelativeSearch:r,onSubmit:d,showLive:R=!1,isLiveMode:$=!1,defaultRelativeTimeMode:L=!1})=>{let{userPreferences:{timeFormat:V}}=(0,P.HW)(),[F,{close:H,toggle:K}]=(0,w.j)(!1);(0,m.vC)("d",()=>K(),{preventDefault:!0},[K]);let Y=i.useMemo(()=>new Date,[]),O=i.useMemo(()=>[...R?[[M.pA,M.e2],"divider"]:[],...M.gw],[R]),[W,G]=(0,u.fp)(T),U=(e=>{let t,s,r=(0,n.c)(3),{mode:a}=e;r[0]===Symbol.for("react.memo_cache_sentinel")?(t={startDate:null,endDate:null,duration:"15m"},r[0]=t):t=r[0],r[1]!==a?(s=e=>{if(a===A.Range&&(!e.startDate||!e.endDate))return{startDate:"Required",endDate:"Required"};if(a===A.Around){if(!e.startDate)return{time:"Required"};if(!e.duration)return{duration:"Required"}}return{}},r[1]=a,r[2]=s):s=r[2];let i=(0,I.m)({mode:"controlled",initialValues:t,validate:s,onValuesChange:e=>{e.endDate&&e.startDate&&e.endDate<e.startDate&&i.setFieldValue("endDate",e.startDate)}});return i})({mode:W}),J=i.useMemo(()=>(0,M.c0)(e),[e]);i.useEffect(()=>{if(!F&&J[0]&&J[1]){if(W===A.Range)U.setValues({startDate:J[0],endDate:J[1]});else if(W===A.Around){let e=new Date((J[0].getTime()+J[1].getTime())/2);U.setFieldValue("startDate",e)}}},[J,F,W]);let X=i.useCallback((e,s)=>{t(e),r?.(s),H()},[H,t,r]),Q=i.useCallback(e=>{if("string"==typeof e){t(e),s(e),H();return}let[r,a]=e;if(!r||!a)return;let n="24h"===V?"MMM d HH:mm:ss":"MMM d h:mm:ss a",i=[r,a].map(e=>e&&(0,l.A)(e,n)).join(" - ");t(i),s(i),H()},[H,t,s,V]),Z=i.useCallback(()=>{if(!U.isValid()||!F)return;let{startDate:e,endDate:t}=U.values;if(W===A.Range&&(Q([e,t]),H()),W===A.Around){let t=M.eh[U.values.duration];Q([e&&(0,o.A)(e,t),e&&(0,c.A)(e,t)]),H()}},[H,U,Q,W,F]);(0,m.vC)("Enter",Z,[Z]);let ee=i.useCallback(e=>{let{startDate:t,endDate:s}=U.values;Q([t&&(0,c.A)(t,e),s&&(0,c.A)(s,e)])},[U.values,Q]),[et,es]=(0,i.useState)(L),[er,ea]=(0,i.useState)(null),en=(0,i.useMemo)(()=>({portalProps:{target:er??void 0}}),[er]);return(0,a.jsxs)(h.A,{position:"bottom-start",closeOnEscape:!0,opened:F,onClose:H,children:[(0,a.jsx)(h.A.Target,{children:(0,a.jsx)(g.k,{"data-testid":"time-picker-input",leftSection:$?(0,a.jsx)(D.A,{size:16,className:"text-brand"}):(0,a.jsx)(k.A,{size:16}),styles:{input:{color:$?"var(--color-text-brand)":"var(--color-text)"}},rightSection:F&&(0,a.jsx)(p.E,{size:"xxs",bg:"var(--color-bg-neutral)",px:4,c:"white",children:"d"}),value:e,onChange:e=>t(e.currentTarget.value),onClick:K,placeholder:"Time Range",size:"sm",w:350,onKeyDown:e=>{"Enter"===e.key&&e.target instanceof HTMLInputElement&&(d?.(e.target.value),H()),"Escape"===e.key&&e.target instanceof HTMLInputElement&&(e.target.blur(),H())}})}),(0,a.jsxs)(h.A.Dropdown,{p:0,"data-testid":"time-picker-popover",ref:ea,children:[(0,a.jsxs)(x.Y,{justify:"space-between",gap:4,px:"xs",py:4,children:[(0,a.jsx)(x.Y,{gap:4,children:"function"==typeof r&&(0,a.jsx)(v.m,{label:"Set how far back Live Tail begins streaming logs.",refProp:"rootRef",children:(0,a.jsx)(f.d,{"data-testid":"time-picker-relative-switch",size:"xs",checked:et,onChange:e=>es(e.currentTarget.checked),label:"Relative Time",labelPosition:"right",styles:{label:{paddingLeft:"5px"}}})})}),(0,a.jsxs)(x.Y,{gap:4,children:[(0,a.jsx)(S.$,{"data-testid":"time-picker-1h-back",size:"compact-xs",variant:"secondary",onClick:ee.bind(null,{hours:-1}),disabled:$||et,children:"1h back"}),(0,a.jsx)(S.$,{"data-testid":"time-picker-1h-forward",size:"compact-xs",variant:"secondary",onClick:ee.bind(null,{hours:1}),disabled:$||et,children:"1h forward"}),(0,a.jsx)(y.J,{"data-testid":"time-picker-close",onClick:H})]})]}),(0,a.jsxs)(x.Y,{gap:1,align:"stretch",children:[(0,a.jsx)(j.Z,{w:180,p:0,children:(0,a.jsx)(b.F,{h:300,scrollbarSize:5,children:(0,a.jsx)(C.B,{gap:0,p:"xs",children:O.map((t,s)=>"divider"===t?(0,a.jsx)(N.c,{my:4},s):(0,a.jsx)(S.$,{disabled:et&&!t[2]&&t[0]!==M.pA,onClick:()=>{et||t[0]===M.pA?X?.(t[0],t[1]):Q(t[0])},w:"100%",size:"compact-xs",color:"gray",variant:e===t[0]?"filled":"subtle",fw:"normal",fz:"xs",fullWidth:!0,justify:"space-between",children:t[0]},t[0]))})})}),(0,a.jsxs)(j.Z,{w:280,p:"xs",children:[(0,a.jsxs)(C.B,{gap:8,mb:"sm",children:[(0,a.jsx)(_.I,{size:"xs",mb:"xs",data:[A.Range,A.Around],value:W,disabled:et,onChange:e=>{if(G(e),e===A.Around&&U.values.startDate&&U.values.endDate){let e=new Date((U.values.startDate.getTime()+U.values.endDate.getTime())/2),t=(U.values.endDate.getTime()-U.values.startDate.getTime())/2/6e4,s="15m";s=t<=.5?"30s":t<=1?"1m":t<=5?"5m":t<=15?"15m":t<=30?"30m":t<=60?"1h":t<=180?"3h":t<=360?"6h":"12h",U.setValues({startDate:e,duration:s})}}}),W===A.Range?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z,{children:"Start time"}),(0,a.jsx)(B,{disabled:et,popoverProps:en,maxDate:Y,mb:"xs",...U.getInputProps("startDate")}),(0,a.jsx)(z,{children:"End time"}),(0,a.jsx)(B,{popoverProps:en,maxDate:Y,minDate:U.values.startDate??void 0,disabled:et,...U.getInputProps("endDate")})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z,{children:"Time"}),(0,a.jsx)(B,{disabled:et,popoverProps:en,maxDate:Y,mb:"xs",...U.getInputProps("startDate")}),(0,a.jsx)(z,{children:"Duration \xb1"}),(0,a.jsx)(q.l,{placeholder:"Pick value",data:M.U$,comboboxProps:en,searchable:!0,size:"xs",disabled:et,variant:"filled",...U.getInputProps("duration")})]})]}),(0,a.jsx)(p.E,{size:"xxs",lh:1.2,children:"You can use natural language to select dates (e.g. yesterday, last monday at 5pm)"}),(0,a.jsx)(E.$,{flex:1}),(0,a.jsx)(x.Y,{justify:"flex-end",mt:8,pt:8,style:{borderTop:"1px solid var(--color-border)"},children:(0,a.jsx)(S.$,{"data-testid":"time-picker-apply",size:"compact-sm",variant:"primary",disabled:!U.isValid()||et,onClick:Z,children:"Apply"})})]})]})]})]})});function L(e){"Enter"===e.key&&e.target instanceof HTMLInputElement&&e.target.blur()}},89011:e=>{e.exports={sourceSchemaPreviewButton:"SourceSelectControlled_sourceSchemaPreviewButton__qKlsK"}},89962:e=>{e.exports={container:"ServiceMap_container__gQ6W_",toolbar:"ServiceMap_toolbar__ORSDP",linkButton:"ServiceMap_linkButton__vWK1Q",serviceNode:"ServiceMap_serviceNode__ixi_4",body:"ServiceMap_body___HL8_",circle:"ServiceMap_circle__N0cV2"}},98287:(e,t,s)=>{"use strict";s.d(t,{A:()=>$});var r=s(6029),a=s(75155),n=s(55729),i=s(56992),l=s.n(i),o=s(35467),c=s(53061),u=s(94720),d=s(43517),m=s(24589),p=s(60481),h=s(60665),g=s(57703),x=s(22476),v=s(80519),f=s.n(v),S=s(67270),y=s(12482),j=s(49672),b=s(78550);async function C({source:e,dateRange:t,traceId:s,metadata:r,samplingFactor:a}){let n=s?1:a,i={from:e.from,connection:e.connection,dateRange:t,timestampValueExpression:e.timestampValueExpression,filters:[{type:"sql",condition:`cityHash64(${e.traceIdExpression}) % ${n} = 0`},...s?[{type:"sql",condition:f().format("?? = ?",[e.traceIdExpression,s])}]:[]],select:[{valueExpression:e.traceIdExpression??"TraceId",alias:"traceId"},{valueExpression:e.spanIdExpression??"SpanId",alias:"spanId"},{valueExpression:e.serviceNameExpression??"ServiceName",alias:"serviceName"},{valueExpression:e.parentSpanIdExpression??"ParentSpanId",alias:"parentSpanId"},{valueExpression:e.statusCodeExpression??"StatusCode",alias:"statusCode"}]},[l,c]=await Promise.all([(0,S.PV)({...i,filters:[...i.filters,{type:"sql",condition:`${e.spanKindExpression} IN ('Server', 'Consumer', 'SPAN_KIND_SERVER', 'SPAN_KIND_CONSUMER')`}],where:""},r,e.querySettings),(0,S.PV)({...i,filters:[...i.filters,{type:"sql",condition:`${e.spanKindExpression} IN ('Client', 'Producer', 'SPAN_KIND_CLIENT', 'SPAN_KIND_PRODUCER')`}],where:""},r,e.querySettings)]);return(0,o.kg)`
    WITH 
      ServerSpans AS (${l}),
      ClientSpans AS (${c})
    SELECT
      ServerSpans.serviceName AS serverServiceName,
      ServerSpans.statusCode AS serverStatusCode,
      ClientSpans.serviceName AS clientServiceName,
      count(*) * ${{Int64:n}} as requestCount
    FROM ServerSpans
      LEFT JOIN ClientSpans
        ON ServerSpans.traceId = ClientSpans.traceId
        AND ServerSpans.parentSpanId = ClientSpans.spanId
    WHERE (ClientSpans.serviceName IS NULL OR ServerSpans.serviceName != ClientSpans.serviceName)
    GROUP BY serverServiceName, serverStatusCode, clientServiceName
    ORDER BY serverServiceName, serverStatusCode, clientServiceName
  `}function N(e){return e.data.map(_)}function _(e){return{serverServiceName:e.serverServiceName,serverStatusCode:e.serverStatusCode,clientServiceName:e.clientServiceName,requestCount:Number.parseInt(e.requestCount)}}function q(e){return e.json()}var E=s(88339),R=s(8737),w=s(81278),D=s.n(w);function k({dateRange:e,source:t,where:s}){let r=e[0].getTime().toString(),a=e[1].getTime().toString(),n=new URLSearchParams({isLive:"false",source:t?.id,where:s,whereLanguage:"sql",from:r,to:a});D().push(`/search?${n.toString()}`)}var P=s(89962),A=s.n(P);function I(e){let t,s,n,i,l,o=(0,a.c)(19),{totalRequests:c,errorPercentage:u,source:d,dateRange:m,serviceName:p,isSingleTrace:h}=e;o[0]!==m||o[1]!==p||o[2]!==d?(t=()=>k({dateRange:m,source:d,where:f().format("? = ? AND ? IN ('Server', 'Consumer')",[f().raw(d.serviceNameExpression??"ServiceName"),p,f().raw(d.spanKindExpression??"SpanKind")])}),o[0]=m,o[1]=p,o[2]=d,o[3]=t):t=o[3],o[4]!==h||o[5]!==c?(s=h?c:function(e){if(e<1e3)return`~${e.toString()}`;if(e<1e6){let t=e/1e3;return`~${Math.round(t)}k`}if(e<1e9){let t=e/1e6;return`~${Math.round(t)}M`}let t=e/1e9;return`~${Math.round(t)}B`}(c),o[4]=h,o[5]=c,o[6]=s):s=o[6];let g=1!==c?"s":"";return o[7]!==t||o[8]!==s||o[9]!==g?(n=(0,r.jsxs)(R.N,{onClick:t,className:A().linkButton,children:[s," ","request",g]}),o[7]=t,o[8]=s,o[9]=g,o[10]=n):n=o[10],o[11]!==m||o[12]!==u||o[13]!==p||o[14]!==d?(i=u>0?(0,r.jsxs)(r.Fragment,{children:[", ",(0,r.jsxs)(R.N,{onClick:()=>k({dateRange:m,source:d,where:f().format("? = ? AND ? IN ('Server', 'Consumer') AND ? = 'Error'",[f().raw(d.serviceNameExpression??"ServiceName"),p,f().raw(d.spanKindExpression??"SpanKind"),f().raw(d.statusCodeExpression??"StatusCode")])}),className:A().linkButton,children:[u.toFixed(2),"% error"]})]}):null,o[11]=m,o[12]=u,o[13]=p,o[14]=d,o[15]=i):i=o[15],o[16]!==n||o[17]!==i?(l=(0,r.jsxs)("div",{className:A().toolbar,children:[n,i]}),o[16]=n,o[17]=i,o[18]=l):l=o[18],l}let M={service:function(e){let t,s,n,i,l,o,c,u,m,p,h=(0,a.c)(27),{data:v}=e,{serviceName:f,incomingRequests:S,source:y,dateRange:j,maxErrorPercentage:b,isSingleTrace:C}=v,{totalRequests:N,errorPercentage:_}=S;if(h[0]!==_||h[1]!==b||h[2]!==e.selected){var q;let s;q=e.selected,s=b>0?Math.min(_,b)/b*100:0,t={backgroundColor:`hsl(0 ${s}% 80%)`,borderColor:q?"white":`hsl(0 ${s}% 40%)`},h[0]=_,h[1]=b,h[2]=e.selected,h[3]=t}else t=h[3];let{backgroundColor:E,borderColor:R}=t;return h[4]!==j||h[5]!==_||h[6]!==C||h[7]!==f||h[8]!==y||h[9]!==N?(s=(0,r.jsx)(x.ER,{position:g.yX.Top,align:"center",children:(0,r.jsx)(I,{errorPercentage:_,totalRequests:N,source:y,dateRange:j,serviceName:f,isSingleTrace:C})}),h[4]=j,h[5]=_,h[6]=C,h[7]=f,h[8]=y,h[9]=N,h[10]=s):s=h[10],h[11]===Symbol.for("react.memo_cache_sentinel")?(n=(0,r.jsx)("div",{className:"position-relative",children:(0,r.jsx)(x.h7,{type:"target",position:g.yX.Left,style:{visibility:"hidden",marginLeft:3}})}),h[11]=n):n=h[11],h[12]!==E||h[13]!==R?(i=(0,r.jsx)("div",{className:A().circle,style:{backgroundColor:E,borderColor:R}}),h[12]=E,h[13]=R,h[14]=i):i=h[14],h[15]===Symbol.for("react.memo_cache_sentinel")?(l={marginLeft:-3},h[15]=l):l=h[15],h[16]===Symbol.for("react.memo_cache_sentinel")?(o=(0,r.jsx)("div",{className:"position-relative",style:l,children:(0,r.jsx)(x.h7,{type:"source",position:g.yX.Right,style:{visibility:"hidden"}})}),h[16]=o):o=h[16],h[17]!==i?(c=(0,r.jsxs)("div",{className:A().body,children:[n,i,o]}),h[17]=i,h[18]=c):c=h[18],h[19]!==f?(u=(0,r.jsx)(d.E,{size:"xxs",children:f}),h[19]=f,h[20]=u):u=h[20],h[21]!==c||h[22]!==u?(m=(0,r.jsxs)("div",{className:`${A().serviceNode}`,children:[c,u]}),h[21]=c,h[22]=u,h[23]=m):m=h[23],h[24]!==s||h[25]!==m?(p=(0,r.jsxs)(r.Fragment,{children:[s,m]}),h[24]=s,h[25]=m,h[26]=p):p=h[26],p}},T={request:function(e){let t,s,n,i,l,o=(0,a.c)(21);o[0]!==e?(t=(0,g.Fp)(e),o[0]=e,o[1]=t):t=o[1];let[c,u,d]=t;if(!e.data)return null;let{totalRequests:m,errorPercentage:p,dateRange:h,serviceName:v,source:f,isSingleTrace:S}=e.data;return o[2]!==c||o[3]!==e.id?(s=(0,r.jsx)(x.tE,{id:e.id,path:c}),o[2]=c,o[3]=e.id,o[4]=s):s=o[4],o[5]!==h||o[6]!==p||o[7]!==S||o[8]!==v||o[9]!==f||o[10]!==m?(n=(0,r.jsx)(I,{totalRequests:m,errorPercentage:p,source:f,dateRange:h,serviceName:v,isSingleTrace:S}),o[5]=h,o[6]=p,o[7]=S,o[8]=v,o[9]=f,o[10]=m,o[11]=n):n=o[11],o[12]!==u||o[13]!==d||o[14]!==e.id||o[15]!==e.selected||o[16]!==n?(i=(0,r.jsx)(x.dN,{edgeId:e.id,x:u,y:d,isVisible:e.selected,children:n}),o[12]=u,o[13]=d,o[14]=e.id,o[15]=e.selected,o[16]=n,o[17]=i):i=o[17],o[18]!==s||o[19]!==i?(l=(0,r.jsxs)(r.Fragment,{children:[s,i]}),o[18]=s,o[19]=i,o[20]=l):l=o[20],l}};function B(e){let t,s,i,h,v,f,S,y,j,b,C,N,_=(0,a.c)(36),{services:q,isLoading:R,error:w,dateRange:D,source:k,isSingleTrace:P}=e;_[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],_[0]=t):t=_[0];let[I,B]=(0,n.useState)(t);_[1]===Symbol.for("react.memo_cache_sentinel")?(s=[],_[1]=s):s=_[1];let[$,L]=(0,n.useState)(s),{fitView:V}=(0,x.VH)();_[2]!==V?(i=()=>{V()},_[2]=V,_[3]=i):i=_[3],_[4]!==V||_[5]!==q?(h=[V,q],_[4]=V,_[5]=q,_[6]=h):h=_[6],(0,n.useEffect)(i,h),_[7]===Symbol.for("react.memo_cache_sentinel")?(v=e=>B(t=>(0,x._0)(e,t)),_[7]=v):v=_[7];let F=v;_[8]===Symbol.for("react.memo_cache_sentinel")?(f=e=>L(t=>(0,x.zW)(e,t)),_[8]=f):f=_[8];let H=f,K=0;if(_[9]!==K||_[10]!==q){for(let e of q?.values()??[])K=Math.max(e.incomingRequests.errorPercentage,K);_[9]=K,_[10]=q,_[11]=K}else K=_[11];let Y=K;if(_[12]!==D||_[13]!==P||_[14]!==Y||_[15]!==q||_[16]!==k?(S=()=>{let e=Array.from(q?.values()??[]).map((e,t)=>({id:e.serviceName,data:{...e,dateRange:D,source:k,maxErrorPercentage:Y,isSingleTrace:P},position:{x:150*t,y:100},type:"service"}))??[],t=Array.from(q?.values()??[]).filter(z).flatMap(e=>{let{serviceName:t,incomingRequestsByClient:s}=e;return Array.from(s.entries()).map(e=>{let[s,r]=e,{totalRequests:a,errorPercentage:n}=r;return{id:`${t}-${s}`,source:s,target:t,animated:!0,type:"request",data:{totalRequests:a,errorPercentage:n,source:k,dateRange:D,serviceName:t,isSingleTrace:P}}})});B(function(e,t){let s=new(l()).graphlib.Graph().setDefaultEdgeLabel(()=>({}));for(let t of(s.setGraph({rankdir:"LR"}),e))s.setNode(t.id,{width:80,height:40});for(let e of t)s.setEdge(e.source,e.target);return l().layout(s),e.map(e=>{let t=s.node(e.id);return{...e,targetPosition:g.yX.Left,sourcePosition:g.yX.Right,position:{x:t.x-40,y:t.y-40}}})}(e,t)),L(t)},y=[q,D,k,Y,P],_[12]=D,_[13]=P,_[14]=Y,_[15]=q,_[16]=k,_[17]=S,_[18]=y):(S=_[17],y=_[18]),(0,n.useEffect)(S,y),R){let e;return _[19]===Symbol.for("react.memo_cache_sentinel")?(e=(0,r.jsx)(c.o,{className:`${A().graphContainer} h-100 w-100`,children:(0,r.jsx)(u.a,{size:"lg"})}),_[19]=e):e=_[19],e}if(q&&0===q.size){let e;return _[20]===Symbol.for("react.memo_cache_sentinel")?(e=(0,r.jsx)(c.o,{className:"w-100 h-100",children:(0,r.jsx)(d.E,{size:"sm",c:"gray.5",children:"No services found. The Service Map shows links between services with related Client- and Server-kind spans."})}),_[20]=e):e=_[20],e}if(w){let e,t,s,a,n;_[21]===Symbol.for("react.memo_cache_sentinel")?(e=(0,r.jsx)(d.E,{my:"sm",size:"sm",children:"Error message:"}),_[21]=e):e=_[21],_[22]===Symbol.for("react.memo_cache_sentinel")?(t={whiteSpace:"pre-wrap"},_[22]=t):t=_[22];let i=w?.message;return _[23]!==i?(s=(0,r.jsx)(m.C,{block:!0,style:t,children:i}),_[23]=i,_[24]=s):s=_[24],_[25]!==w?(a=w instanceof o.p1&&(0,r.jsxs)(p.a,{mt:"lg",children:[(0,r.jsx)(d.E,{my:"sm",size:"sm",children:"Original query:"}),(0,r.jsx)(m.C,{block:!0,style:{whiteSpace:"pre-wrap"},children:(0,r.jsx)(E.V,{data:w.query,formatData:!0})})]}),_[25]=w,_[26]=a):a=_[26],_[27]!==s||_[28]!==a?(n=(0,r.jsxs)(p.a,{children:[e,s,a]}),_[27]=s,_[28]=a,_[29]=n):n=_[29],n}return _[30]===Symbol.for("react.memo_cache_sentinel")?(j={backgroundColor:"inherit"},_[30]=j):j=_[30],_[31]===Symbol.for("react.memo_cache_sentinel")?(b={hideAttribution:!0},C=(0,r.jsx)(x.H2,{showInteractive:!1}),_[31]=b,_[32]=C):(b=_[31],C=_[32]),_[33]!==$||_[34]!==I?(N=(0,r.jsx)("div",{className:A().container,children:(0,r.jsx)(x.Gc,{style:j,nodes:I,edges:$,onNodesChange:F,onEdgesChange:H,nodeTypes:M,edgeTypes:T,fitView:!0,colorMode:"dark",proOptions:b,children:C})}),_[33]=$,_[34]=I,_[35]=N):N=_[35],N}function z(e){return e.incomingRequestsByClient.size>0}function $(e){let t,s,i,l,o=(0,a.c)(15),{traceId:c,traceTableSource:u,dateRange:d,samplingFactor:m,isSingleTrace:p}=e,g=void 0===m?1:m;o[0]!==d||o[1]!==g||o[2]!==c||o[3]!==u?(t={traceId:c,source:u,dateRange:d,samplingFactor:g},o[0]=d,o[1]=g,o[2]=c,o[3]=u,o[4]=t):t=o[4];let{isLoading:v,data:f,error:S}=function(e){let t,s,r,n=(0,a.c)(15),{source:i,dateRange:l,traceId:o,samplingFactor:c}=e,u=(0,j.fu)(),d=(0,b.Ge)();return n[0]!==l||n[1]!==c||n[2]!==i||n[3]!==o?(t=["serviceMapData",o,i,l,c],n[0]=l,n[1]=c,n[2]=i,n[3]=o,n[4]=t):t=n[4],n[5]!==u||n[6]!==l||n[7]!==d||n[8]!==c||n[9]!==i||n[10]!==o?(s=async e=>{let{signal:t}=e,s=await C({source:i,dateRange:l,traceId:o,metadata:d,samplingFactor:c});return function(e){let t=new Map;for(let s of e){let{serverServiceName:e,serverStatusCode:r,clientServiceName:a,requestCount:n}=s;t.has(e)||t.set(e,{serviceName:e,incomingRequests:{totalRequests:0,requestCountByStatus:new Map,errorPercentage:0},incomingRequestsByClient:new Map});let i=t.get(e);i.incomingRequests.totalRequests+=n;let l=i.incomingRequests.requestCountByStatus.get(r)||0;if(i.incomingRequests.requestCountByStatus.set(r,l+n),a){i.incomingRequestsByClient.has(a)||i.incomingRequestsByClient.set(a,{totalRequests:0,requestCountByStatus:new Map,errorPercentage:0});let e=i.incomingRequestsByClient.get(a);e.totalRequests+=n;let s=e.requestCountByStatus.get(r)||0;e.requestCountByStatus.set(r,s+n),t.has(a)||t.set(a,{serviceName:a,incomingRequests:{totalRequests:0,requestCountByStatus:new Map,errorPercentage:0},incomingRequestsByClient:new Map})}}for(let e of t.values()){let t=e.incomingRequests.requestCountByStatus.get("Error")||0;for(let s of(e.incomingRequests.errorPercentage=e.incomingRequests.totalRequests>0?t/e.incomingRequests.totalRequests*100:0,e.incomingRequestsByClient.values())){let e=s.requestCountByStatus.get("Error")||0;s.errorPercentage=s.totalRequests>0?e/s.totalRequests*100:0}}return t}(await u.query({query:s.sql,query_params:s.params,connectionId:i.connection,format:"JSON",abort_signal:t,clickhouse_settings:{max_execution_time:60,join_algorithm:"auto"}}).then(q).then(N))},n[5]=u,n[6]=l,n[7]=d,n[8]=c,n[9]=i,n[10]=o,n[11]=s):s=n[11],n[12]!==t||n[13]!==s?(r={queryKey:t,queryFn:s,staleTime:1/0,refetchOnWindowFocus:!1,retry:1},n[12]=t,n[13]=s,n[14]=r):r=n[14],(0,y.I)(r)}(t);return o[5]!==S?(s=()=>{S&&h.$e.show({title:"Error loading service map",message:S.message,color:"red"})},i=[S],o[5]=S,o[6]=s,o[7]=i):(s=o[6],i=o[7]),(0,n.useEffect)(s,i),o[8]!==d||o[9]!==S||o[10]!==v||o[11]!==p||o[12]!==f||o[13]!==u?(l=(0,r.jsx)(x.Ln,{children:(0,r.jsx)(B,{services:f,isLoading:v,error:S,dateRange:d,source:u,isSingleTrace:p})}),o[8]=d,o[9]=S,o[10]=v,o[11]=p,o[12]=f,o[13]=u,o[14]=l):l=o[14],l}}}]);