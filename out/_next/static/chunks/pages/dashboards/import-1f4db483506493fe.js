(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521],{6061:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboards/import",function(){return s(90491)}])},9211:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var a=s(6029),n=s(75155),t=s(1909),l=s(38206);function i(e){let r,s,i,o,c,d=(0,n.c)(16),{field:u,fieldState:m}=(0,t.as)(e),{value:h,onChange:p,onBlur:x,name:f,ref:j}=u;d[0]!==e?({onCreate:r,allowDeselect:i,...s}=e,d[0]=e,d[1]=r,d[2]=s,d[3]=i):(r=d[1],s=d[2],i=d[3]);let g=void 0===i||i,v=e.data?.find(e=>"string"==typeof e?e===h:!("value"in e)||e.value===h);d[4]!==g||d[5]!==p||d[6]!==r?(o=e=>{"_create_new_value"===e&&null!=r?r():(null!==e||g)&&p(e)},d[4]=g,d[5]=p,d[6]=r,d[7]=o):o=d[7];let b=o,S=m.error?.message,_=null==v?null:h;return d[8]!==f||d[9]!==x||d[10]!==j||d[11]!==b||d[12]!==s||d[13]!==S||d[14]!==_?(c=(0,a.jsx)(l.l,{...s,error:S,value:_,onChange:b,onBlur:x,name:f,ref:j}),d[8]=f,d[9]=x,d[10]=j,d[11]=b,d[12]=s,d[13]=S,d[14]=_,d[15]=c):c=d[15],c}},21587:(e,r,s)=>{"use strict";s.d(r,{z:()=>i});var a=s(6029),n=s(75155),t=s(58525),l=s.n(t);let i=e=>{let r,s=(0,n.c)(2),{children:t}=e;return s[0]!==t?(r=(0,a.jsxs)("div",{className:l().header,children:[" ",t]}),s[0]=t,s[1]=r):r=s[1],r}},58525:e=>{e.exports={header:"PageHeader_header__Rc2pT"}},90491:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>J});var a=s(6029),n=s(75155),t=s(55729),l=s(71024),i=s.n(l),o=s(95669),c=s.n(o),d=s(81278),u=s(1909),m=s(6065),h=s(6663),p=s(52789),x=s(76089),f=s(82641),j=s(3635),g=s(43517),v=s(25062),b=s(22599),S=s(34834),_=s(59029),w=s(11088),y=s(83171),N=s(23950),T=s(78341),E=s(60665),X=s(48080),D=s(74011),I=s(30597),M=s(70114),C=s(21587),k=s(9211),z=s(36600),A=s(97344),R=s(56514),$=s(81973);let F=f.mJ;function Y(e){let r,s,l,i,o,c,d,m,x=(0,n.c)(25),{onComplete:f}=e,_=h.Ik({file:h.Nl(File).nullable()}),[w,y]=(0,t.useState)(null),[E,C]=(0,T.j)(!1),{toggle:k}=C,z=(0,p.u)(_);x[0]!==z?(r={resolver:z},x[0]=z,x[1]=r):r=x[1];let{control:A,handleSubmit:R}=(0,u.mN)(r);x[2]!==f||x[3]!==y?(s=async e=>{let{file:r}=e;if(y(null),r)try{let e=await r.text(),s=JSON.parse(e),a=F.parse(s);f(a)}catch(e){f(null),y({message:"Failed to Import Dashboard",details:e?.message??"Failed to parse/validate JSON"})}},x[2]=f,x[3]=y,x[4]=s):s=x[4];let $=s;return x[5]!==R||x[6]!==$?(l=R($),x[5]=R,x[6]=$,x[7]=l):l=x[7],x[8]!==R||x[9]!==$||x[10]!==y?(i=e=>{let{field:r}=e;return(0,a.jsx)(N.mR,{onDrop:e=>{r.onChange(e[0]),R($)()},onReject:()=>y({message:"Invalid File Type or Size"}),maxSize:5242880,maxFiles:1,accept:["application/json"],children:(0,a.jsxs)(j.Y,{justify:"center",gap:"xl",mih:150,style:{pointerEvents:"none"},children:[(0,a.jsx)(N.mR.Accept,{children:(0,a.jsx)(X.A,{size:52,color:"var(--color-text-brand)",stroke:1.5})}),(0,a.jsx)(N.mR.Reject,{children:(0,a.jsx)(D.A,{size:52,color:"var(--color-text-danger)",stroke:1.5})}),(0,a.jsx)(N.mR.Idle,{children:(0,a.jsx)(I.A,{size:52,color:"var(--color-text-muted)",stroke:1.5})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.E,{size:"xl",inline:!0,children:"Import Dashboard"}),(0,a.jsx)(g.E,{size:"sm",c:"dimmed",inline:!0,mt:7,children:"Drag and drop a JSON file here, or click to select from your computer."})]})]})})},x[8]=R,x[9]=$,x[10]=y,x[11]=i):i=x[11],x[12]!==A||x[13]!==i?(o=(0,a.jsx)(u.xI,{name:"file",control:A,render:i}),x[12]=A,x[13]=i,x[14]=o):o=x[14],x[15]!==w||x[16]!==E||x[17]!==k?(c=w&&(0,a.jsxs)("div",{children:[(0,a.jsx)(g.E,{c:"red",children:w.message}),w.details&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.$,{variant:"transparent",onClick:k,px:0,children:(0,a.jsxs)(j.Y,{c:"red",gap:0,align:"center",children:[(0,a.jsx)(M.A,{size:"16px",style:{transition:"transform 0.2s ease-in-out",transform:E?"rotate(90deg)":"rotate(0deg)"}}),E?"Hide Details":"Show Details"]})}),(0,a.jsx)(b.S,{in:E,children:(0,a.jsx)(g.E,{c:"red",children:w.details})})]})]}),x[15]=w,x[16]=E,x[17]=k,x[18]=c):c=x[18],x[19]!==o||x[20]!==c?(d=(0,a.jsxs)(S.B,{gap:"sm",children:[o,c]}),x[19]=o,x[20]=c,x[21]=d):d=x[21],x[22]!==l||x[23]!==d?(m=(0,a.jsx)("form",{onSubmit:l,children:d}),x[22]=l,x[23]=d,x[24]=m):m=x[24],m}let O=h.Ik({dashboardName:h.Yj().min(1),sourceMappings:h.YO(h.Yj()),filterSourceMappings:h.YO(h.Yj()).optional()});function P({input:e}){let r=(0,d.useRouter)(),{data:s}=(0,$.oE)(),[n]=(0,m.useQueryParam)("dashboardId",m.StringParam),{handleSubmit:l,getFieldState:i,control:o,setValue:c}=(0,u.mN)({resolver:(0,p.u)(O),defaultValues:{dashboardName:e.name,sourceMappings:e.tiles.map(()=>void 0)}});(0,t.useEffect)(()=>{if(!e||!s)return;let r=e.tiles.map(e=>{let r=s.find(r=>r.name.toLowerCase()===e.config.source.toLowerCase());return r?.id||""}),a=e.filters?.map(e=>{let r=s.find(r=>r.name.toLowerCase()===e.source.toLowerCase());return r?.id||""});c("sourceMappings",r),c("filterSourceMappings",a)},[c,s,e]);let h=(0,t.useRef)(!1),f=(0,u.FH)({control:o,name:"sourceMappings"}),j=(0,t.useRef)(f);(0,t.useEffect)(()=>{if(h.current||!f||!e.tiles)return;let r=f.findIndex((e,r)=>e!==j.current?.[r]);if(-1===r)return;j.current=f;let s=e.tiles[r];if(!s)return;let a=f[r]??"",n=e.tiles.map((e,r)=>({...e,index:r})).filter(e=>e.config.source===s.config.source).map(({index:e})=>`sourceMappings.${e}`),t=e.filters?.map((e,r)=>({...e,index:r})).filter(e=>e.source===s.config.source).map(({index:e})=>`filterSourceMappings.${e}`)??[];for(let e of(h.current=!0,[...n,...t]))i(e).isDirty||c(e,a,{shouldValidate:!0});h.current=!1},[f,e.tiles,e.filters,i,c]);let b=(0,A.mG)(),y=(0,A.vY)(),N=async a=>{try{let t=e.tiles.map((e,r)=>{let n=s?.find(e=>e.id===a.sourceMappings[r]);return{...e,config:{...e.config,source:n.id}}}),l=e.filters?.map((e,r)=>{let n=s?.find(e=>e.id===a.filterSourceMappings?.[r]);return{...e,source:n.id}}),i=(0,x.sE)({...e,tiles:t,filters:l,name:a.dashboardName}),o=n;o?await y.mutateAsync({...i,id:o}):o=(await b.mutateAsync(i)).id,E.$e.show({color:"green",message:"Import Successful!"}),r.push(`/dashboards/${o}`)}catch{E.$e.show({color:"red",message:"Something went wrong. Please try again."})}};return(0,a.jsx)("form",{onSubmit:l(N),children:(0,a.jsxs)(S.B,{gap:"sm",children:[(0,a.jsx)(g.E,{fw:500,size:"sm",children:"Step 2: Map Data"}),(0,a.jsx)(u.xI,{name:"dashboardName",control:o,render:({field:e,formState:r})=>(0,a.jsx)(_.k,{label:"Dashboard Name",...e,error:r.errors.dashboardName?.message})}),(0,a.jsxs)(w.X,{children:[(0,a.jsx)(w.X.Thead,{children:(0,a.jsxs)(w.X.Tr,{children:[(0,a.jsx)(w.X.Th,{children:"Name"}),(0,a.jsx)(w.X.Th,{children:"Input Source Name"}),(0,a.jsx)(w.X.Th,{children:"Mapped Source Name"})]})}),(0,a.jsxs)(w.X.Tbody,{children:[e.tiles.map((e,r)=>(0,a.jsxs)(w.X.Tr,{children:[(0,a.jsx)(w.X.Td,{children:e.config.name}),(0,a.jsx)(w.X.Td,{children:e.config.source}),(0,a.jsx)(w.X.Td,{children:(0,a.jsx)(k.A,{control:o,name:`sourceMappings.${r}`,data:s?.map(e=>({value:e.id,label:e.name})),placeholder:"Select a source"})})]},e.id)),e.filters?.map((e,r)=>(0,a.jsxs)(w.X.Tr,{children:[(0,a.jsxs)(w.X.Td,{children:[e.name," (filter)"]}),(0,a.jsx)(w.X.Td,{children:e.source}),(0,a.jsx)(w.X.Td,{children:(0,a.jsx)(k.A,{control:o,name:`filterSourceMappings.${r}`,data:s?.map(e=>({value:e.id,label:e.name})),placeholder:"Select a source"})})]},e.id))]})]}),b.isError&&(0,a.jsx)(g.E,{c:"red",children:b.error.toString()}),(0,a.jsx)(v.$,{type:"submit",loading:b.isPending,children:"Finish Import"})]})})}function B(){let e,r,s,l,i,o,d=(0,n.c)(11),u=(0,z.Kh)(),[m,h]=(0,t.useState)(null);return d[0]!==u?(e=(0,a.jsx)(c(),{children:(0,a.jsxs)("title",{children:["Create a Dashboard - ",u]})}),d[0]=u,d[1]=e):e=d[1],d[2]===Symbol.for("react.memo_cache_sentinel")?(r=(0,a.jsx)(C.z,{children:(0,a.jsx)("div",{children:"Create Dashboard > Import Dashboard"})}),d[2]=r):r=d[2],d[3]===Symbol.for("react.memo_cache_sentinel")?(s=(0,a.jsx)(Y,{onComplete:e=>{h(e)}}),d[3]=s):s=d[3],d[4]!==m?(l=m&&(0,a.jsx)(P,{input:m}),d[4]=m,d[5]=l):l=d[5],d[6]!==l?(i=(0,a.jsx)("div",{children:(0,a.jsx)(y.m,{children:(0,a.jsxs)(S.B,{gap:"lg",mt:"xl",children:[s,l]})})}),d[6]=l,d[7]=i):i=d[7],d[8]!==e||d[9]!==i?(o=(0,a.jsxs)("div",{children:[e,r,i]}),d[8]=e,d[9]=i,d[10]=o):o=d[10],o}let L=i()(async()=>B,{ssr:!1});L.getLayout=R.D;let J=L}},e=>{e.O(0,[7756,883,2928,910,1606,1909,6747,2814,9967,1021,6514,6593,636,8792],()=>e(e.s=6061)),_N_E=e.O()}]);